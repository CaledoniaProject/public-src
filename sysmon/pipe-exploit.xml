<!-- https://labs.jumpsec.com/detecting-known-dll-hijacking-and-named-pipe-token-impersonation-attacks-with-sysmon/ -->
<Sysmon schemaversion="4.22">
    <EventFiltering>
        <RuleGroup name="CVE-2020-13770" groupRelation="and">
            <PipeEvent onmatch="include">
                <!-- Monitor CreatePipe events -->
                <EventType condition="is">CreatePipe</EventType>
                <!-- Only log these named pipes -->
                <PipeName condition="is">\SQLLocal\ldmsdata</PipeName>
            </PipeEvent>
            <PipeEvent onmatch="exclude">
                <!-- Only log if the pipe is not created by these (legitimate) processes -->
                <Image condition="is">C:\Program Files\Microsoft SQL Server\MSSQL13.LDMSDATA\MSSQL\Binn\sqlservr.exe</Image>
            </PipeEvent>
        </RuleGroup>
    </EventFiltering>
</Sysmon>

